% pop_eztopo() - Plot power values on topography 
%                (topoplot walk-through guide)
%
% Usage: (In your commandlind type:)
%   >> pop_eztopo(allPSDs);    % pop-up window
%
% Inputs:
%   data     - variable name of your power values (e.g. allPSDs)
%              *  If plotting allPSDs, 3D matrix that contains power
%                 values of each channel in each frequency bin.
%              ** If > 1 subject in allPSDs, pop-up window provides 
%                 options to either averaging all subjects or choosing a 
%                 specific one.
%
% [Color Scheme Guide]
%   - parula : Color-blind friendly color scheme and visually easy to
%              understand the intensity. (Becoming the standard color
%              scheme.)
%   - jet    : Works best when values could be both positive and negative
%   - hot    : Works best when values are only nonnegative
%   - gray   : Saves $$$ if submitting to journals that charge for color
%              figures
% 
%  * Note: EEGLAB must be opened when using this function!
%
% Author: Joel Frohlich, UCLA CART, 08/10/2016

function pop_eztopo(allPSDs)

display('         ')
display(date)
display('                                          ')


display('@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'); pause(0.01); 
display('@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'); pause(0.01); 
display('@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@ Joel @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@ Frohlich @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@ UCLA @ CART @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+.;:;;;;.+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+;:,.`          .,,;@@@@@@@@@@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.,.        `,::,.       .:@@@@@@@@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@;.      `;+++@+.;.;;;+++...   ,:@@@@@@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@@@@@@@@@+,     :+++@+;,.,;+++@.;;:``,+.:  `,.@@@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@ I @@@@@@@@@@@@@@@@@@@@;.   :..@@;::;.+@@@.;;;;;.@@@.,  .;   ,;@@@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@ LIKE @@@@@@@@@@@@@@@+`  `..@;`+,.@@+..;;.;...;.;....@.. ,+.  ,.@@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@ STARWARS @@@@@@@@@@:   ;+.:  ;@@;;........;;....::;...@.` ..  ,.@@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@@@,  :..,.@@@+....;;,:.:::,,,.::,:::;...@. +`  .+@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@@:  .+ ,@+.+.:::;:::,:;:,,,,,:;,,::,,::;;@, +   .@@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@;  +. ;@;.;.::,::,,,,,:,,,,,,:::,:.,:,,::..;..  ,.@@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@+` +, +@....::,,,:,,,,:;,,,,:,,::,,;:,,,::;...+;``,@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@` +``@....;::,,,,,,:,,,;,,,,,,,,,,,.,,:;::;.;@,+  ,+@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@. .,.@.;;;:,,,,,:,,,:,,,;,,,,,,,,,,:;,,;,,:...+::;  :@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@. ,:,@.::::,,,,,,::,,:,,,:,,,:,,,,,,;,,;:,:;;;.;@ +  ,@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@  +,@;:,,,,,,,,,::,,,:,,,,,,,:,,,,,,;,,.,,:::,;+. .,  :@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@; @ @+:,,,,,,,,,:,,,,,:,,,,,,,;,,:::;:,,;,,,::::..+ @  ,@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@ ...+.;,,,,,,,,,.,,,,,::,,::::,:,,,,,:,:,,:,,,,,.@@ ;   :@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@: @;+;:;:,,:,,,,,,,;;:,,,,:,,:,,,.,,,,,,;,:,,,,,:;++:,+  `+@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@ . @::,,,,,,:,:,,::,,,,,.,,,,,,,,,,,,,:::,,::,,;,:.@@..   ,@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@; ++.,:,,,,,,,:,,,:,,,.,.,,,,,.,,,,,,:;:,,,,:,,:,,:;@..++  .@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@ :,@;,,:,,,,,,:,.,,.,,,,,,,,,,,,,,,.,,,,,;,,,,:,,,,:+@@`+  `@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@. @+:,,,,,,.,,,:,,,.,,,,,,,,,,,,,,,,,,,,,,:,,,,:,:,,:.@+`..  ;@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@. :@:,,:,,,,::::,.,,,,...:,:,,,..,,,,,,,,:,,,,:,,:,::;@+: @, :@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@ +.;,,,,:,.,;,,,.,,.,,;..;.;;:.;,,,,.,,,,:,,,;:,:,:,,;.@+ +, ,@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@; @@:,,,,,:,:,,,,,,,.:.;;;.;:,,:::,,...:,,:,,:,,,:::,,;.@+ .; .@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@,`+@;,,..,,,,:,,:,.,;;;;;;.,,.,,,;;:.,,,::,,,,,,,:,,:,:+@+` + `+@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@ .@@;::,,,.,,;,,,,.:;:::;;:,,,,,,:;:...:;;::::,.,,,:,:,;@@, @  ;@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@. @@@,,,,,,,,,:,,.,,;::::;;,,,,,,,,;..,,+;;;;;:,:::,,,,,;@@: +  :@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@. @@@,,,,,,,,,:,,,,,::,,:;:,,,,,,,,:;;;..;;.;;;,,,,:,,,:;@@; .` ,@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@ ,@@@;:,::,,,,,,,,,.,,,,::,,,,,,,,,,;;;.;.;;::.;:,,,,;;:.@@: ;, ,@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@ +@@@.,,,,:,:,,:,,.,,,,,,,,,,,,,,,,,,,,.;;;:::.:;:,,,::;.+@. ;: ,@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@. @@@@@,,,.,,:,,,:,,,,,,,,,.,,,,,.,..,,.:;;:,:,::;;,,,,,:..@  ;: ,@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@;`++@@@+,,,:,:,,,,,:,,,,,,,,,,,,...,,.,,,;;;:,,:,:;.:,,,;.+.  .` .@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@...@@@@@;,,,,,:,,,,,,,,:,,:;,,,::,,,,,.,:;:,,:,,::;::;::;;.: `@  .@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@+.+@@@@@@,,,,,,:,,,,,,:::,+:,;.;::,.,,,,:.,,:,,,:;::,:;.;.;` .@  .@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@`@.@@@@@;,:,::,,::,,,::;;,,;...:..,,,,,,::,,,,,,:;:,,;;;;.  ;@  ,@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@,:.@@@@@@++:,,,,,,,,:,:;.;;;....,,,.,,,,:,,,,,,:,:,:,:;;;+  +@  ,@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@:`+@@@@@@+@+.;;,,,::,:+@@:` @@;:,,,,,.,,;:,,,,,,,:,,;,..;+`.+@  :@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@: .@@@@@++@+.@++@@@@@@@@;`,@@,+.,,,,,,,;..:,,,,,,.;;;:..: :@.  ;@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@  `..;++.;;@@+.@@@++@@@@@+@@+.,.,,,,,,:...:,,,:,;,,;;;.` .@   .@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@;  .+..@@...;@@.@@++@@@@@@@@@..,,,,,,,,..:,,,,,,;;:;.;; :+@  .@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@.:;;;:;.....@++;;+..@@@@@@@@@@+;:,,,,,,,.:,,,,,,,,,;:;.  +@,  ,@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@.;;...;::::;;:;;;.:.+.@@@@@@@@@ .+,,,,,,,::,,,,,,,,,;;.` .+,   ,@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@.;;++...+::;;:;;;;;;...@@@@@@@@   ..:,,,,,;.,,,:,,:,:... .;;    :@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@+:;....;;;;:;;;:;;;.;:;..@@@@@@    :..;,,,,;;:,:::,::..: +;:.   ,+@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@,,...;;:::;.:;;:;;;.:;+@.:+@@+.::.  :..,,:,,;;:,:;;....:..;:    :@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@..;...;;;:::;..;;:;;;;;;:;;,,..;,:+.:`+.:,,,,.;,,,..;,:.; :;.    ;@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@.`.;;......;;;;;;:;:;;;;.+@+.::,..`:;:;,@;,:::;.:,:..;;.;.`.::   ,+@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@``,;.........;;.;;;;;;......@@@@@@+:;;  +.+:,,,:......+.;:  ::    :@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@` `::;;..+...;;;;.;....;;;...@@@@@@@:;:   .+;:,:;.......;:  :,:    :@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@. `,;;.+@@+.;;...;;....;;;...+@@@@@@@;;:. , ,.:,:;.....`.,   ..`    ;@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@,,.;;..++..;;;+:;+.;;.+..+++++@@@@@@@:;. .;::.:,:;...:  `    ::     ;@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@,.;+;...+.;...+; ,.@+.....+;,;:+@@@@@:;@@....+;::;....       .,    ..@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@.,,;;:::;..,;:;.++;;:;;;:,   `::+@@@@;;.++:.@+.::...;:`      .,    :+@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@+;;;,.::; .,,:@;+:;;;;;::::; .::+@@@;,.;;::++;:;;+..,`       ,    ;@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@;,;::;;::;+:;;;;;;;;..;;:,,::@@@; .;,,;.+;:;.++;              .@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@.,;;,+@@;;:;:;;;;;;;:;;;;:::;;@@+...`,:.+;;;...   `     .     ;@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@+;.;....;;;;;;;;;;;;;::;;;:;;:@@@,.:.,;++;;;.+:;,,      :     ;@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@;;;.++...;;:;...;;;;;::::;;:;;:@@;.,.,;++;;;++;;;,.;    .     .@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@;.:`:.;;;;;::;;::;.;;;.;:,:;;;:,@@;.,.,;@+;;;++.;,.,.`   ;     ;@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@;...@..;...;.:;:;;;.;;;;,;;;;:@@::`,:;@@;;;+.;;:;;..  `;     .@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@..:;;@+...;;...;;:::..;::::;:;;@@;``;;;@+;..@:;.;;;;: `,:    `.@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@.;:,,:@+.......;:;,;:;.::;:;..+@@..;@@@@@;;.@, `;::.:.,;;    +@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@+.;:`:.@+;....;..;.;;:;;;;;;;+@@@.+.;..++;.;+.:,;.::;`..:    @@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@:::...+.+.+......;;:.;::..@@@@..;;;;@@..++,.;...:;,..:   ,;@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@;,.;;::++.+......;::;;;:;.@@@@+.;;;.+@...+;;;..:;,:+.:   +@@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@.:;+;..`+++.;.....;;;.;;;;;@@@@+.:;..+@..+.;..;:::,:++:   .+@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@;:.:+..,@+.@+++++.;;..;;;..@@@@++;...+@..++.;...:;.;++;   ,+@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@;;+;@;.:@++++++++.....;:;;...@@+++@+@@@..+.,;;+:;.,;+.:   ..@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@;;+:@,,+@@@++++++++....;..++.@@+@+..+@@++@.:.++;..,...:   `+@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@.;.@@;@@++@++@+@++++++.;..++.@@+@+..+@@.+@@;.++...:;+.:    @@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@+;.+@@@@+@@@+@@@@@@+++..++.++@@++..+.@@++@+++.++++;.+.,``` .@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@.;;.@@;:,;+@@@@@@@@...+++++@@@++.++++@++@+..+@+.+..+;:...`:@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@++;;.+@+;:::,+@@@@@+.;..+.@@@@+++@@@@@++@++.+++++..@::,,,.:@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@++.:::.+;;;;;;;+@.;.+.@@@@@@@@+@+@@++@@++@@@@+.++.::,:,:@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@+;;;;;..;;..@+.;.++@@@@@@@@@@@@@@@@@++@@@@@@+@.;::;::@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@.....;...@@+;.+@@@@@@@@@@@@+@@@@@@@@@@@@@@+@..;;;;;@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@@@+....++@++++++@@@@@@@@++@@@@@@@@@@@@@@@@@@.......@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@@@@@@+++@+++++@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@++++++@@@@@@@@@@@@@@@'); pause(0.01)
display('@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@'); pause(0.01)

display(' NOTE! Please make sure you have eeglab open while using this function. Otherwise, topoplot() cannot be accessed.')
display('                       ')
p = which('CorrectChanLocs.mat');
load(p);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

options = struct('Resize','on','WindowStyle','normal','Interpreter','tex');

if nargin < 1
    help pop_eztopo;
    dataSet = inputdlg({'What is the name of data variable? Notice this is case-sensitive.'},...
        'EZ TOPO',[1 60],cell({'allPSDs'}),options);
    if isempty(dataSet), return; end
    try 
        allPSDs = evalin('base', dataSet{1});
    catch
        error('Variable not existent')
    end
end

howMany = ndims(allPSDs);

if howMany == 3 
    a = inputdlg({'I see there are multiple subjects. Average which subjects?'},...
        'EZ-Topo',[1 60],cell({'1'}),options);
    if isempty(a), return; end
    NDX = str2num(a{:});
    allPSDs = mean(allPSDs(:,:,NDX),3);
end

if howMany > 1 
    sss = size(allPSDs);
    if sss(1) == 130 && sss(2) > 1
        b = inputdlg({'It looks like you might be plotting spectral power. Are you plotting relative or absolute [R/A]?',...
            'What is the lowest frequency in the band of interest?',...
            'What is the highest frequency in the band of interest?',...
            'What is the lowest frequency in the passband?',...
            'What is the highest frequency in the passband?'},...
            'EZ-Topo',[1 100; 1 100; 1 100;1 100; 1 100], ...
            cell({'r','8','12','1','48'}), options);
        if isempty(b), return; end
        F = round(allPSDs(130,:));
        L = length(F);

        high = b(3);
        low = b(2);

        bottom = b(4);
        top = b(5);

        for j = 1:L
            if F(j) == round(str2num(bottom{:}))
                START = j;
            end
            
            if F(j) == round(str2num(low{:}))
                LO = j;
            end
            
            if F(j) == round(str2num(high{:}))
                HI = j;
            end
            
            if F(j) == round(str2num(top{:}))
                STOP = j;
            end
            
        end
        
        if ~exist('LO','var')
            error('Please make sure the 130th row of the matrix contains frequency bin indices!')
        end
        

        SIGMA = sum(allPSDs(:,LO:HI),2);
        TOTAL = sum(allPSDs(:,START:STOP),2);

        if strcmpi(b(1),'r') || strcmpi(b(1),'relative')
            display('             ')
            display('CALCULATING RELATIVE POWER')
            display('    ')
            allPSDs = SIGMA./TOTAL;
        else
            display('             ')
            display('CALCULATING ABSOLUTE POWER')
            display('    ')
            allPSDs = SIGMA;
        end
    end
    
end

x = inputdlg({'Which channels should be used?'},'EZ-Topo',[1 60],cell({'1:129'}));
if isempty(x), return; end
chans = str2num(x{:});

answer = inputdlg({'Show electrode as dots? [Y/N]','Include skirt channels? [Y/N]','High res (takes longer)? [Y/N]','How many contour lines?','Which color scheme (Jet, Parula, Hot, or Gray)?','Show colorscale? [Y/N]'},'EZ-Topo', [1 19; 1 19; 1 19; 1 19; 1 60; 1 19],cell({'n','y','y','6','jet','n'}));
if isempty(answer), return; end

if strcmpi(answer(1),'Y')
    plotE = 'on';
else
    plotE = 'off';
end



if strcmpi(answer(2),'Y')
    plotrad = 1.0;
else
    plotrad = 0.5;
end


if strcmpi(answer(3),'Y')
    gridscale = 264;
else
    gridscale = 64;
end

n = (answer(4));

N = str2num(n{:});

figure

topoplot(allPSDs,chanLocs,'plotchans',chans,'maplimits','maxmin','electrodes',...
    plotE,'plotrad',plotrad,'gridscale',gridscale,'conv','on','numcontour',...
    N,'emarker',{'s','k',2,1})


axis([-0.6 0.6 -0.6 0.6])


if strcmpi(answer(6),'Y')
    cbar
end

pause(1)

display('Setting color scheme ... ')

answer(5)

if strcmpi(answer(5),'jet')
    colormap jet
elseif strcmpi(answer(5),'parula')
    colormap parula
elseif strcmpi(answer(5),'hot')
    colormap hot
elseif strcmpi(answer(5),'gray')
    colormap gray
else
    colormap jet
end

end